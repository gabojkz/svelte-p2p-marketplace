<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Live trade room - Chat with seller and complete your transaction">
    <title>Trade Room #TR-78234 - LocalMarket</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/responsive.css">
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè™</text></svg>">
    
    <style>
        /* Trade Room Mobile Styles */
        .trade-room-page {
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .trade-room-header {
            background: var(--color-white);
            border-bottom: 1px solid var(--color-gray-200);
            padding: var(--space-3) var(--space-4);
            flex-shrink: 0;
        }
        
        .trade-room-header__inner {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-3);
        }
        
        .trade-room-content {
            flex: 1;
            display: flex;
            overflow: hidden;
            background: var(--color-gray-100);
        }
        
        .chat-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--color-white);
            min-width: 0;
        }
        
        .trade-sidebar {
            width: 360px;
            flex-shrink: 0;
            overflow-y: auto;
            padding: var(--space-4);
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
            background: var(--color-gray-50);
            border-left: 1px solid var(--color-gray-200);
        }
        
        .chat-header {
            padding: var(--space-3) var(--space-4);
            border-bottom: 1px solid var(--color-gray-200);
            background: var(--color-white);
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-4);
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
            background: var(--color-gray-50);
        }
        
        .chat-input {
            padding: var(--space-3) var(--space-4);
            border-top: 1px solid var(--color-gray-200);
            background: var(--color-white);
        }
        
        .chat-input form {
            display: flex;
            gap: var(--space-2);
        }
        
        .chat-input input {
            flex: 1;
        }
        
        /* Chat Message Styles */
        .chat-message {
            display: flex;
            gap: var(--space-2);
            max-width: 80%;
        }
        
        .chat-message--own {
            margin-left: auto;
            flex-direction: row-reverse;
        }
        
        .chat-message__bubble {
            padding: var(--space-3) var(--space-4);
            background: var(--color-gray-100);
            border-radius: var(--radius-lg);
            border-top-left-radius: var(--radius-sm);
            font-size: var(--text-sm);
            line-height: var(--leading-relaxed);
        }
        
        .chat-message--own .chat-message__bubble {
            background: var(--color-primary);
            color: white;
            border-top-left-radius: var(--radius-lg);
            border-top-right-radius: var(--radius-sm);
        }
        
        .chat-message__time {
            font-size: var(--text-xs);
            color: var(--color-gray-400);
            margin-top: var(--space-1);
            display: block;
        }
        
        .chat-message--own .chat-message__time {
            text-align: right;
        }
        
        /* System Message */
        .chat-system-message {
            text-align: center;
            padding: var(--space-2) var(--space-4);
            background: var(--color-primary-subtle);
            border-radius: var(--radius-full);
            font-size: var(--text-xs);
            color: var(--color-gray-600);
            margin: var(--space-2) auto;
            max-width: fit-content;
        }
        
        /* Payment Card */
        .payment-card {
            background: var(--color-white);
            border: 1px solid var(--color-gray-200);
            border-radius: var(--radius-md);
            padding: var(--space-3);
        }
        
        /* Mobile toggle buttons */
        .mobile-tab-bar {
            display: none;
            background: var(--color-white);
            border-top: 1px solid var(--color-gray-200);
            padding: var(--space-2);
        }
        
        .mobile-tab-bar button {
            flex: 1;
            padding: var(--space-3);
            border: none;
            background: transparent;
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            color: var(--color-gray-500);
            cursor: pointer;
            border-radius: var(--radius-md);
        }
        
        .mobile-tab-bar button.is-active {
            background: var(--color-primary-subtle);
            color: var(--color-primary);
        }
        
        .trade-sidebar-toggle {
            display: none;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .trade-sidebar {
                position: fixed;
                top: 0;
                right: -100%;
                width: 100%;
                max-width: 320px;
                height: 100vh;
                z-index: 100;
                transition: right 0.3s ease;
                box-shadow: var(--shadow-xl);
            }
            
            .trade-sidebar.is-open {
                right: 0;
            }
            
            .trade-sidebar-overlay {
                position: fixed;
                inset: 0;
                background: rgba(0,0,0,0.5);
                z-index: 99;
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease;
            }
            
            .trade-sidebar-overlay.is-visible {
                opacity: 1;
                visibility: visible;
            }
            
            .trade-sidebar-toggle {
                display: flex;
            }
            
            .mobile-tab-bar {
                display: flex;
            }
            
            .chat-message {
                max-width: 90%;
            }
            
            .chat-header .desktop-actions {
                display: none;
            }
        }
        
        /* Very small mobile */
        @media (max-width: 480px) {
            .trade-room-header__inner {
                flex-wrap: wrap;
            }
            
            .chat-header {
                padding: var(--space-2) var(--space-3);
            }
            
            .chat-messages {
                padding: var(--space-3);
            }
            
            .chat-input {
                padding: var(--space-2) var(--space-3);
            }
        }
    </style>
</head>
<body class="trade-room-page">
    
    <!-- Trade Room Header -->
    <header class="trade-room-header">
        <div class="trade-room-header__inner">
            <a href="messages.html" style="display: flex; align-items: center; gap: var(--space-2); text-decoration: none; color: inherit;">
                <span style="font-size: var(--text-xl);">‚Üê</span>
                <span style="font-weight: var(--font-medium);">Back</span>
            </a>
            
            <div style="flex: 1; text-align: center;">
                <div style="font-weight: var(--font-semibold); font-size: var(--text-sm);">2019 BMW 3 Series</div>
                <span class="badge badge--warning" style="font-size: 10px;">In Progress</span>
            </div>
            
            <button class="btn btn--ghost btn--sm trade-sidebar-toggle" id="toggleSidebar">
                <span>Details</span>
            </button>
        </div>
    </header>

    <!-- Main Trade Room Content -->
    <div class="trade-room-content">
        
        <!-- Chat Panel -->
        <div class="chat-panel">
            
            <!-- Chat Header -->
            <div class="chat-header">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="avatar avatar--sm">JD</div>
                        <div>
                            <div style="font-weight: var(--font-semibold); font-size: var(--text-sm);">John Doe</div>
                            <div class="flex items-center gap-1" style="font-size: var(--text-xs); color: var(--color-gray-500);">
                                <span class="status-dot status-dot--online"></span>
                                <span>Online</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex gap-2 desktop-actions">
                        <button class="btn btn--ghost btn--sm">üìé</button>
                        <button class="btn btn--ghost btn--sm" data-modal-target="dispute-modal">‚ö†Ô∏è</button>
                    </div>
                </div>
            </div>

            <!-- Chat Messages -->
            <div class="chat-messages" id="chatMessages">
                
                <!-- System Message -->
                <div class="chat-system-message">
                    üîí Trade started. Item reserved in escrow.
                </div>

                <!-- Seller Message -->
                <div class="chat-message">
                    <div class="avatar avatar--sm">JD</div>
                    <div>
                        <div class="chat-message__bubble">
                            Hi! Thanks for your interest in the BMW. It's still available. When would you like to view it?
                        </div>
                        <span class="chat-message__time">10:32 AM</span>
                    </div>
                </div>

                <!-- Own Message -->
                <div class="chat-message chat-message--own">
                    <div>
                        <div class="chat-message__bubble">
                            Hi John! I'd love to see it. Are you available this Saturday afternoon?
                        </div>
                        <span class="chat-message__time">10:35 AM</span>
                    </div>
                </div>

                <!-- Seller Message -->
                <div class="chat-message">
                    <div class="avatar avatar--sm">JD</div>
                    <div>
                        <div class="chat-message__bubble">
                            Saturday at 2pm works perfectly! Here's my location:
                        </div>
                        <span class="chat-message__time">10:36 AM</span>
                    </div>
                </div>

                <!-- Location Card -->
                <div class="chat-message">
                    <div class="avatar avatar--sm">JD</div>
                    <div>
                        <div class="payment-card">
                            <div style="font-weight: var(--font-semibold); margin-bottom: var(--space-2); font-size: var(--text-sm);">üìç Meeting Location</div>
                            <div style="font-size: var(--text-xs); line-height: var(--leading-relaxed); color: var(--color-gray-600);">
                                Costa Coffee, Eldon Square<br>
                                Newcastle upon Tyne, NE1 7JB
                            </div>
                            <button class="btn btn--ghost btn--sm mt-2" style="font-size: var(--text-xs);">
                                üìã Copy Address
                            </button>
                        </div>
                        <span class="chat-message__time">10:37 AM</span>
                    </div>
                </div>

                <!-- Own Message -->
                <div class="chat-message chat-message--own">
                    <div>
                        <div class="chat-message__bubble">
                            Perfect! I'll see you there at 2pm. I'll be wearing a blue jacket üëç
                        </div>
                        <span class="chat-message__time">10:38 AM</span>
                    </div>
                </div>

                <!-- System Message -->
                <div class="chat-system-message">
                    üìÖ Meeting scheduled for Saturday, 2:00 PM
                </div>

            </div>

            <!-- Chat Input -->
            <div class="chat-input">
                <form>
                    <button type="button" class="btn btn--ghost btn--sm" style="padding: var(--space-2);">üìé</button>
                    <input type="text" class="form-input" placeholder="Type a message..." style="font-size: 16px;">
                    <button type="submit" class="btn btn--primary btn--sm">
                        <span style="display: none;">Send</span>
                        <span>‚û§</span>
                    </button>
                </form>
            </div>

            <!-- Mobile Tab Bar -->
            <div class="mobile-tab-bar">
                <button class="is-active">üí¨ Chat</button>
                <button id="mobileShowDetails">üìã Trade Details</button>
                <button data-modal-target="dispute-modal">‚ö†Ô∏è Help</button>
            </div>
        </div>

        <!-- Trade Sidebar -->
        <aside class="trade-sidebar" id="tradeSidebar">
            
            <!-- Close button for mobile -->
            <button class="btn btn--ghost btn--sm" id="closeSidebar" style="align-self: flex-end; display: none;">
                ‚úï Close
            </button>
            
            <!-- Trade Status Card -->
            <div class="card">
                <div class="card__body">
                    <h4 style="margin-bottom: var(--space-4); font-size: var(--text-base);">Trade Status</h4>
                    
                    <!-- Progress Steps -->
                    <div style="display: flex; flex-direction: column; gap: var(--space-2); margin-bottom: var(--space-4);">
                        <div class="flex items-center gap-2">
                            <div style="width: 24px; height: 24px; background: var(--color-primary); border-radius: var(--radius-full); display: flex; align-items: center; justify-content: center; color: white; font-size: 10px;">‚úì</div>
                            <div style="flex: 1;">
                                <div style="font-size: var(--text-xs); font-weight: var(--font-medium);">Trade Started</div>
                            </div>
                        </div>
                        <div style="width: 2px; height: 16px; background: var(--color-primary); margin-left: 11px;"></div>
                        <div class="flex items-center gap-2">
                            <div style="width: 24px; height: 24px; background: var(--color-primary); border-radius: var(--radius-full); display: flex; align-items: center; justify-content: center; color: white; font-size: 10px;">‚úì</div>
                            <div style="flex: 1;">
                                <div style="font-size: var(--text-xs); font-weight: var(--font-medium);">Item Reserved</div>
                            </div>
                        </div>
                        <div style="width: 2px; height: 16px; background: var(--color-accent-yellow); margin-left: 11px;"></div>
                        <div class="flex items-center gap-2">
                            <div style="width: 24px; height: 24px; background: var(--color-accent-yellow); border-radius: var(--radius-full); display: flex; align-items: center; justify-content: center; font-size: 10px;">3</div>
                            <div style="flex: 1;">
                                <div style="font-size: var(--text-xs); font-weight: var(--font-medium); color: var(--color-accent-yellow);">Meeting Scheduled</div>
                            </div>
                        </div>
                        <div style="width: 2px; height: 16px; background: var(--color-gray-200); margin-left: 11px;"></div>
                        <div class="flex items-center gap-2">
                            <div style="width: 24px; height: 24px; background: var(--color-gray-200); border-radius: var(--radius-full); display: flex; align-items: center; justify-content: center; color: var(--color-gray-500); font-size: 10px;">4</div>
                            <div style="flex: 1;">
                                <div style="font-size: var(--text-xs); color: var(--color-gray-500);">Complete Trade</div>
                            </div>
                        </div>
                    </div>

                    <!-- Buttons -->
                    <button class="btn btn--primary btn--full btn--sm mb-2" data-modal-target="confirm-payment-modal">
                        ‚úì Mark as Complete
                    </button>
                    <button class="btn btn--outline btn--full btn--sm">
                        Cancel Trade
                    </button>
                </div>
            </div>

            <!-- Trade Details Card -->
            <div class="card">
                <div class="card__body">
                    <h4 style="margin-bottom: var(--space-3); font-size: var(--text-base);">Trade Details</h4>
                    
                    <div style="display: flex; flex-direction: column; gap: var(--space-2); font-size: var(--text-xs);">
                        <div class="flex justify-between">
                            <span class="text-muted">Trade ID</span>
                            <span style="font-family: var(--font-mono);">#TR-78234</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-muted">Item</span>
                            <span style="font-weight: var(--font-medium);">2019 BMW 3 Series</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-muted">Price</span>
                            <span style="font-weight: var(--font-semibold); color: var(--color-primary);">¬£18,500</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-muted">Location</span>
                            <span>Newcastle, UK</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-muted">Meeting</span>
                            <span>Sat, 2:00 PM</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Seller Info Card -->
            <div class="card">
                <div class="card__body">
                    <h4 style="margin-bottom: var(--space-3); font-size: var(--text-base);">Seller</h4>
                    
                    <div class="flex items-center gap-3 mb-3">
                        <div class="avatar">JD</div>
                        <div>
                            <div style="font-weight: var(--font-semibold); font-size: var(--text-sm);">John Doe</div>
                            <div style="font-size: var(--text-xs); color: var(--color-gray-500);">
                                ‚≠ê 4.9 (47 reviews) ‚Ä¢ Verified
                            </div>
                        </div>
                    </div>
                    
                    <a href="user-profile.html" class="btn btn--ghost btn--full btn--sm">View Profile</a>
                </div>
            </div>

            <!-- Escrow Info -->
            <div style="padding: var(--space-3); background: var(--color-primary-subtle); border-radius: var(--radius-md); text-align: center;">
                <span style="font-size: var(--text-lg);">üõ°Ô∏è</span>
                <p style="font-size: var(--text-xs); margin-top: var(--space-1);">
                    Protected by LocalMarket Escrow
                </p>
            </div>

        </aside>
        
        <!-- Sidebar Overlay for mobile -->
        <div class="trade-sidebar-overlay" id="sidebarOverlay"></div>
    </div>

    <!-- Confirm Payment Modal -->
    <div class="modal-backdrop"></div>
    <div class="modal" id="confirm-payment-modal">
        <div class="modal__header">
            <h3 class="modal__title">Complete Trade</h3>
            <button class="modal__close" data-modal-close>&times;</button>
        </div>
        <div class="modal__body">
            <div class="alert alert--warning mb-4">
                <span class="alert__icon">‚ö†Ô∏è</span>
                <div class="alert__content">
                    <p class="alert__message">Only mark as complete if you have received the item and are satisfied.</p>
                </div>
            </div>
            
            <p style="margin-bottom: var(--space-4);">Please confirm that you have:</p>
            
            <div style="display: flex; flex-direction: column; gap: var(--space-3); margin-bottom: var(--space-4);">
                <label class="form-check">
                    <input type="checkbox" class="form-check-input">
                    <span class="form-check-label">Met with the seller</span>
                </label>
                <label class="form-check">
                    <input type="checkbox" class="form-check-input">
                    <span class="form-check-label">Inspected the item</span>
                </label>
                <label class="form-check">
                    <input type="checkbox" class="form-check-input">
                    <span class="form-check-label">Completed the payment</span>
                </label>
            </div>
        </div>
        <div class="modal__footer">
            <button class="btn btn--outline" data-modal-close>Cancel</button>
            <a href="feedback.html" class="btn btn--primary">Complete Trade</a>
        </div>
    </div>

    <!-- Dispute Modal -->
    <div class="modal" id="dispute-modal">
        <div class="modal__header">
            <h3 class="modal__title">Report an Issue</h3>
            <button class="modal__close" data-modal-close>&times;</button>
        </div>
        <div class="modal__body">
            <p style="margin-bottom: var(--space-4);">Having issues with this trade? Let us know:</p>
            
            <div class="form-group">
                <label class="form-label">Issue Type</label>
                <select class="form-select">
                    <option value="">Select an issue...</option>
                    <option value="no-response">Seller not responding</option>
                    <option value="no-show">Seller didn't show up</option>
                    <option value="wrong-item">Item not as described</option>
                    <option value="scam">Suspected scam</option>
                    <option value="other">Other</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Description</label>
                <textarea class="form-textarea" rows="3" placeholder="Describe the issue..."></textarea>
            </div>
        </div>
        <div class="modal__footer">
            <button class="btn btn--outline" data-modal-close>Cancel</button>
            <a href="dispute.html" class="btn btn--danger">Submit Report</a>
        </div>
    </div>

    <script src="../js/main.js"></script>
    <script>
        // Mobile sidebar toggle
        const toggleSidebar = document.getElementById('toggleSidebar');
        const closeSidebar = document.getElementById('closeSidebar');
        const mobileShowDetails = document.getElementById('mobileShowDetails');
        const tradeSidebar = document.getElementById('tradeSidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        
        function openSidebar() {
            tradeSidebar.classList.add('is-open');
            sidebarOverlay.classList.add('is-visible');
            closeSidebar.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }
        
        function closeSidebarFn() {
            tradeSidebar.classList.remove('is-open');
            sidebarOverlay.classList.remove('is-visible');
            document.body.style.overflow = '';
        }
        
        if (toggleSidebar) toggleSidebar.addEventListener('click', openSidebar);
        if (mobileShowDetails) mobileShowDetails.addEventListener('click', openSidebar);
        if (closeSidebar) closeSidebar.addEventListener('click', closeSidebarFn);
        if (sidebarOverlay) sidebarOverlay.addEventListener('click', closeSidebarFn);
        
        // Scroll chat to bottom on load
        const chatMessages = document.getElementById('chatMessages');
        if (chatMessages) {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
    </script>
</body>
</html>
